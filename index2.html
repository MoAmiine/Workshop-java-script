<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./assets/css/main.css">
    <title>SCRUM Board</title>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ SCRUM Board</h1>
            <p>G√©rez vos projets avec agilit√©</p>
        </div>
        <div class="controls">
            <div class="control-group">
                <h3>üë§ Ajouter un Collaborateur</h3>
                <div class="input-group">
                    <input type="text" id="collaboratorName" placeholder="Nom du collaborateur">
                    <button onclick="addCollaborator()">Ajouter</button>
                </div>
                <div id="collaboratorsList"></div>
            </div>
            <div class="control-group">
                <h3>üìù Ajouter une User Story</h3>
                <div class="input-group">
                    <input type="text" id="storyTitle" placeholder="Titre de la story">
                </div>
                <div class="input-group">
                    <textarea id="storyDescription" placeholder="Description d√©taill√©e"></textarea>
                </div>
                <div class="input-group">
                    <select id="storySprint">
                        <option value="1">Sprint 1</option>
                        <option value="2">Sprint 2</option>
                        <option value="3">Sprint 3</option>
                    </select>
                    <select id="storyAssignee">
                        <option value="">Non assign√©</option>
                    </select>
                </div>
                <button onclick="addUserStory()">Cr√©er Story</button>
            </div>
        </div>

        <div class="sprint-backlog">
            <h2>üìã Sprint Backlog</h2>
            <div id="sprintBacklog"></div>
        </div>

        <div class="scrum-board">
            <h2>üìä SCRUM Board</h2>
            <div class="board-columns">
                <div class="column todo">
                    <h3>√Ä Faire</h3>
                    <div id="todo" class="column-content"></div>
                </div>
                <div class="column in-progress">
                    <h3>En Cours</h3>
                    <div id="in-progress" class="column-content"></div>
                </div>
                <div class="column testing">
                    <h3>En Test</h3>
                    <div id="testing" class="column-content"></div>
                </div>
                <div class="column done">
                    <h3>Termin√©</h3>
                    <div id="done" class="column-content"></div>
                </div>
            </div>
        </div>
    </div>
    <script>
        let collaborators = [];
        let userStories = [];
        let boardStories = [];
        let storyIdCounter = 1;
        let collaboratorNameInput = document.getElementById('collaboratorName');

        /**
         * Fonction pour ajouter un nouveau collaborateur √† l'√©quipe
         * TODO: 
         * - R√©cup√©rer la valeur du champ input avec l'id 'collaboratorName'
         * - V√©rifier que le nom n'est pas vide et n'existe pas d√©j√† dans le tableau 'collaborators'
         * - Ajouter le collaborateur au tableau 'collaborators'
         * - Vider le champ input
         * - Appeler updateCollaboratorsList() pour afficher la liste
         * - Appeler updateAssigneeSelect() pour mettre √† jour le select d'assignation
         */
        var utiliteurNom;
        function addCollaborator() {
            utiliteurNom = collaboratorNameInput.value.trim();
            if (utiliteurNom === '' || collaborators.includes(utiliteurNom) || message === "") {
                collaboratorNameInput.style.borderColor = 'red';
                let message = document.createElement('span');
                let parent = document.querySelector('.input-group');
                parent.appendChild(message);
                if (message === "") {

                    message.innerText = 'Nom invalide ou d√©j√† existant';
                }
                message.style.color = 'red';
                message.style.display = 'flex';
                message.style.alignItems = 'center';
                return;
            } else {
                collaborators.push(utiliteurNom);
            }
            collaboratorNameInput.value = '';
            updateCollaboratorsList()
            updateAssigneeSelect()
        }

        /**
         * Fonction pour afficher la liste des collaborateurs dans l'interface
         * TODO:
         * - R√©cup√©rer l'√©l√©ment DOM avec l'id 'collaboratorsList'
         * - G√©n√©rer du HTML pour chaque collaborateur (badges avec leur nom)
         * - Utiliser un style inline: background #667eea, color white, padding 8px 15px, border-radius 20px
         * - Injecter le HTML dans l'√©l√©ment avec innerHTML
         */

        function updateCollaboratorsList() {
            let collaborateurList = document.getElementById('collaboratorsList');
            let badge = document.createElement('span');
            badge.innerText = utiliteurNom;
            badge.style.background = '#667eea';
            badge.style.color = 'white';
            badge.style.padding = '8px 15px';
            badge.style.borderRadius = '20px';
            collaborateurList.appendChild(badge);
        }

        /**
         * Fonction pour mettre √† jour la liste d√©roulante des assign√©s
         * TODO:
         * - R√©cup√©rer l'√©l√©ment select avec l'id 'storyAssignee'
         * - G√©n√©rer les options: une option "Non assign√©" + une option par collaborateur
         * - Mettre √† jour le select avec innerHTML
         */
        function updateAssigneeSelect() {
            // √Ä IMPL√âMENTER
        }

        /**
         * Fonction pour cr√©er une nouvelle User Story
         * TODO:
         * - R√©cup√©rer les valeurs des champs: storyTitle, storyDescription, storySprint, storyAssignee
         * - V√©rifier que le titre et la description ne sont pas vides
         * - Cr√©er un objet story avec: id (utiliser storyIdCounter++), title, description, sprint (parseInt), assignee, status: 'backlog'
         * - Ajouter la story au tableau 'userStories'
         * - Vider les champs titre et description
         * - Appeler renderSprintBacklog() pour actualiser l'affichage
         */
        function addUserStory() {
            // √Ä IMPL√âMENTER
        }

        /**
         * Fonction pour afficher le Sprint Backlog avec toutes les stories par sprint
         * TODO:
         * - R√©cup√©rer le conteneur avec l'id 'sprintBacklog'
         * - Pour chaque sprint (1, 2, 3):
         *   - Filtrer les stories du sprint avec status 'backlog'
         *   - G√©n√©rer le HTML: conteneur sprint avec header (titre + bouton Start)
         *   - Pour chaque story: afficher titre, description, assign√©
         *   - Si aucune story: afficher "Aucune story dans ce sprint"
         * - Injecter tout le HTML g√©n√©r√© dans le conteneur
         */
        function renderSprintBacklog() {
            // √Ä IMPL√âMENTER
        }

        /**
         * Fonction appel√©e lors du clic sur "D√©marrer Sprint"
         * TODO:
         * - Filtrer toutes les stories du sprint demand√© avec status 'backlog'
         * - Pour chaque story trouv√©e:
         *   - Changer son status √† 'todo'
         *   - Ajouter la story au tableau 'boardStories'
         * - Retirer ces stories du tableau 'userStories'
         * - Appeler renderSprintBacklog() et renderBoard() pour mettre √† jour l'affichage
         */
        function startSprint(sprintNum) {
            // √Ä IMPL√âMENTER
        }

        /**
         * Fonction pour afficher toutes les cartes sur le SCRUM Board
         * TODO:
         * - Pour chaque colonne ('todo', 'in-progress', 'testing', 'done'):
         *   - R√©cup√©rer le conteneur de la colonne
         *   - Filtrer les stories avec le status correspondant depuis 'boardStories'
         *   - Si aucune story: afficher "Aucune carte"
         *   - Sinon g√©n√©rer une carte pour chaque story avec:
         *     - Titre, description, badge assign√©
         *     - Boutons "Suivant" (sauf pour done), "Pr√©c√©dent" (sauf pour todo), "Supprimer"
         *   - Injecter le HTML dans le conteneur
         */
        function renderBoard() {
            // √Ä IMPL√âMENTER
            const cmls = ['todo', 'in-progress', 'testing', 'done']
            cmls.forEach(colum => {
                const container = document.getElementById(colum);
                const stories = boardStories.filter(arr, arr.status === colum);

                if (stories.length === 0) {
                    container.innerHTML = "<div class='card'>pas de cart</div>"
                } else {
                    let bouton = ""

                    if (colum !== 'done') {
                        bouton += `<button class="move-btn" onclick="moveCard(${arr.id}, '${getNextStatus(colum)}')">Suivant ‚Üí</button>`;
                    }

                    if (colum !== 'todo') {
                        bouton += `<button class="move-btn" onclick="moveCard(${arr.id}, '${getPrevStatus(colum)}')">Pr√©c√©dent ‚Üí</button>`;
                    }

                    container.innerHTML = `<div class="card">
                <h3>${arr.titre}</h3>
                <p>${arr.description}</p>
                <p class="assignee">${arr.assignee}</p>
                ${bouton}
            </div>`
                }
            });

        }

        /**
         * Fonction utilitaire pour obtenir le status suivant dans le workflow
         * TODO:
         * - Cr√©er un objet avec les transitions: todo‚Üíin-progress, in-progress‚Üítesting, testing‚Üídone
         * - Retourner le status suivant selon le status actuel
         */
        function getNextStatus(current) {
            // √Ä IMPL√âMENTER
            const obj = { 'todo': 'in-progress', 'in-progres': 'testing', 'testing': 'done' }
            return obj[current]
        }

        /**
         * Fonction utilitaire pour obtenir le status pr√©c√©dent dans le workflow
         * TODO:
         * - Cr√©er un objet avec les transitions: in-progress‚Üítodo, testing‚Üíin-progress, done‚Üítesting
         * - Retourner le status pr√©c√©dent selon le status actuel
         */
        function getPrevStatus(current) {
            // √Ä IMPL√âMENTER
            const obj = { 'in-progress': 'todo', 'testing': 'in-progres', 'done': 'testing' }
            return obj[current]
        }

        /**
         * Fonction pour d√©placer une carte d'une colonne √† une autre
         * TODO
         * - Trouver la story dans 'boardStories' avec l'id donn√©
         * - Modifier son status avec newStatus
         * - Appeler renderBoard() pour actualiser l'affichage
         */
        function moveCard(id, newStatus) {
            // √Ä IMPL√âMENTER
        }

        /**
         * Fonction pour supprimer une carte du board
         * TODO:
         * - Filtrer 'boardStories' pour retirer la story avec l'id donn√©
         * - Appeler renderBoard() pour actualiser l'affichage
         */
        function deleteCard(id) {
            // √Ä IMPL√âMENTER
        }

        // Initialisation
        renderSprintBacklog();
        renderBoard();

    </script>
</body>

</html>